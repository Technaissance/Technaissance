"use strict";function validateEmail(e){return/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(String(e).toLowerCase())}!function(s){var l=null;BbvaComponent.authbbva=function(){l=this},BbvaComponent.authbbva.prototype=new BbvaComponent,BbvaComponent.authbbva.prototype.loadEvents=function(){},BbvaComponent.authbbva.prototype.validateForm=function(e){var r=!1,i=/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/,c=/(?=^.{8,}$)(?=(.*\d){2})(?=(.*[A-Za-z]){2})(?!.*[ÑñÇç\s])^.*/;return l.rootElement.find("input,textarea,select").prop("disabled",!0),l.rootElement.find('input[type="text"],input[type="password"],input[type="email"]').each(function(e,t){var t=s(t),o=(t.val()||"").trim(),a=t.attr("name"),n=t.parent().find("label").text()||a;return o?"email"!==a||i.test(o)?"password"!==a||c.test(o)?"password2"===a&&o!==l.rootElement.find('input[name="password"]').val()?(r=!0,console.error(l.config.passwordsError),l.showMsg(l.config.passwordsError,"danger",t),!1):void 0:(r=!0,console.error(l.config.passwordsRegexError),l.showMsg(l.config.passwordsRegexError,"danger",t),!1):(r=!0,console.error(l.config.errorMail),l.showMsg(l.config.errorMail,"danger",t),!1):(r=!0,console.error("".concat(l.config.requiredField,": ").concat(n)),l.showMsg(l.config.requiredField,"danger",t),!1)}),!r},BbvaComponent.authbbva.prototype.doRemember=function(e){var t={email:e.get("email")};l.config.captcha?t.captcha=e.get("captcha"):l.config.reCaptchaKey&&(t["g-recaptcha-response"]=s("#g-recaptcha-response").val()),l.apiCall("authbbva/remember",{project:l.getProject()},"POST",t,function(e){var t;l.config.reCaptchaKey&&grecaptcha.reset(),e?(t=l.config.msgKo,412===e.status&&(l.config.captcha||l.config.reCaptchaKey)&&(t=l.config.captchaError),l.showMsg(t,"danger"),l.cbForm(e)):(l.showMsg(l.config.msgOk,"success"),l.cbForm(),l.config.rememberRedirect&&window.location.replace(l.config.rememberRedirect))})},BbvaComponent.authbbva.prototype.doLogin=function(e){var t=e.get("username"),o=e.get("password_login"),a=e.get("remember_me"),e="".concat(l.armadillo,"users/access");a&&(e+="?remember_me=true"),s.ajax({url:e,type:"POST",headers:{authorization:"Basic ".concat(btoa("".concat(t,":").concat(o)))},success:function(e,t,o){a&&l.setCookie(l.config.cookieRemember,!0),l.config.loginRedir&&window.location.replace(l.config.loginRedir)},error:function(e){l.showMsg(l.config.msgKo,"danger"),l.cbForm(e)}})},BbvaComponent.authbbva.prototype.doRegister=function(e){var t;e.delete("password2"),e.set("password",btoa(e.get("password"))),l.config.getAutoLang&&(t=(t=(t=((t=window&&window.navigator&&window.navigator.languages||[])&&t.length?t[0]:window.navigator.language||window.navigator.userLanguage)||"es").split(";")[0].split(",")[0].trim()).split("-")[0].trim().toLowerCase(),e.set("ow_lang",t)),l.apiCall("authbbva/",{project:l.getProject()},"POST",e,function(e,t){var o;l.config.reCaptchaKey&&grecaptcha.reset(),e?(o=l.config.msgKo,409===e.status?o=l.config.msgUserExists:412===e.status&&(l.config.captcha||l.config.reCaptchaKey)&&(o=l.config.captchaError),l.showMsg(o,"danger"),l.cbForm(e)):(l.showMsg(l.config.msgOk,"success"),l.rootElement.find('input[type="text"],input[type="password"],textarea').val(""),l.rootElement.find("input,textarea,select").prop("disabled",!1),l.cbForm(),l.config.registerRedirect&&window.location.replace(l.config.registerRedirect))})},BbvaComponent.authbbva.prototype.showActivation=function(e){},BbvaComponent.authbbva.prototype.doResetPassword=function(e){var t=btoa(e.get("password")),e=e.get("ticket");l.apiCall("authbbva/reset",{project:l.getProject()},"POST",{password:t,ticket:e},function(e){var t;e?(t=l.config.msgKo,400===e.status&&(t=l.config.msgPasswordUsed),l.showMsg(t,"danger"),l.cbForm(e)):(l.showMsg(l.config.msgOk,"success"),l.cbForm(),l.config.resetRedirect&&window.location.replace(l.config.resetRedirect))})},BbvaComponent.authbbva.prototype.doActivation=function(e){e=e.get("ticket");l.apiCall("authbbva/activation",{project:l.getProject()},"POST",{ticket:e},function(e){var t;e?(t=l.config.msgKo,l.showMsg(t,"danger"),l.cbForm(e)):(l.showMsg(l.config.msgOk,"success"),l.cbForm(),l.config.activationRedirect&&window.location.replace(l.config.activationRedirect))})},BbvaComponent.authbbva.prototype.requestActivation=function(e){e=e.get("email");l.apiCall("authbbva/request-activation",{project:l.getProject()},"POST",{email:e},function(e){var t;e?(t=l.config.msgKo,412===e.status&&(t=l.config.msgUserActived),l.showMsg(t,"danger"),l.cbForm(e)):(l.showMsg(l.config.msgOk,"success"),l.cbForm(),l.config.activationRedirect&&window.location.replace(l.config.activationRedirect))})},BbvaComponent.authbbva.prototype.cbForm=function(e){e||l.rootElement.find("input,textarea,select").val(""),l.rootElement.find(".wp_captcha_input").val(""),l.rootElement.find(".wp_captcha_get_new").trigger("click"),l.rootElement.find("input,textarea,select").prop("disabled",!1)},BbvaComponent.authbbva.prototype.sendForm=function(e){if(!l.validateForm())return l.rootElement.find("input,textarea,select").prop("disabled",!1),!1;switch(l.config.template){case"remember":return l.doRemember(e);case"login":return l.doLogin(e);case"register":return l.doRegister(e);case"reset":return l.doResetPassword(e);case"activation":return l.doActivation(e);case"request-activation":return l.requestActivation(e)}},BbvaComponent.authbbva.prototype.loadConfig=function(){var e;l.config.cookieRemember="bbva_rememberme",l.config.template=l.rootElement.data("template")||!1,l.config.captcha=l.rootElement.data("captcha")||!1,l.config.roles=l.rootElement.data("roles-enable")||!1,l.config.nameText=l.rootElement.data("name-text")||"Nombre",l.config.surnameText=l.rootElement.data("surname-text")||"Apellidos",l.config.usernameText=l.rootElement.data("username-text")||"Usuario",l.config.emailText=l.rootElement.data("email-text")||"Email",l.config.passwordText=l.rootElement.data("password-text")||"Contraseña",l.config.password2Text=l.rootElement.data("password2-text")||"Repite la contraseña",l.config.userRolesText=l.rootElement.data("user-roles-text")||"Roles de usuario",l.config.captchaText=l.rootElement.data("captcha-text")||"Código de seguridad",l.config.sendText=l.rootElement.data("send-text")||"Enviar",l.config.requiredField=l.rootElement.data("msg-required-field")||"Campo obligatorio",l.config.passwordsError=l.rootElement.data("msg-passwords-error")||"Las contraseñas no coinciden",l.config.passwordsRegexError=l.rootElement.data("msg-passwords-regex-error")||"La contraseña ha de contener 8 caracteres, al menos dos números y/o dos letras y no puede contener caracteres especiales como Ñ o Ç ni haber sido utilizada previamente",l.config.msgOk=l.rootElement.data("msg-ok")||"Peticion realizada con exito",l.config.msgUserExists=l.rootElement.data("msg-register-user-exists")||"El usuario ya existe",l.config.msgKo=l.rootElement.data("msg-ko")||"Error al procesar la peticion",l.config.loginText=l.rootElement.data("login-text")||"¿Ya tienes cuenta?",l.config.loginLink=l.rootElement.data("login-link")||"/login/",l.config.loginRedir=l.rootElement.data("login-redirect")||"/private/",l.config.rememberMeText=l.rootElement.data("remember-me-text")||"Recordarme",l.config.rememberText=l.rootElement.data("remember-text")||"Recordar contraseña",l.config.rememberLink=l.rootElement.data("remember-link")||"/remember",l.config.msgPasswordUsed=l.rootElement.data("msg-password-used")||"La nueva contraseña no puede haber sido utilizada previamente",l.config.registerText=l.rootElement.data("register-text")||"Registrarse",l.config.registerLink=l.rootElement.data("register-link")||"/register/",l.config.registerRedirect=l.rootElement.data("register-redirect")||!1,l.config.errorMail=l.rootElement.data("error-mail")||"Correo electrónico no válido",l.config.captchaError=l.rootElement.data("msg-captcha-error")||"Código captcha no válido",l.config.ticketText=l.rootElement.data("ticket-text")||"Código de seguridad recibido por correo electrónico",l.config.resetRedirect=l.rootElement.data("reset-redirect")||!1,l.config.rememberRedirect=l.rootElement.data("remember-redirect")||"/reset/",l.config.reCaptchaKey=l.rootElement.data("recaptcha-visible")||l.rootElement.data("recaptcha-invisible")||!1,l.config.reCaptchaVisible=void 0!==l.rootElement.data("recaptcha-visible"),l.config.reCaptchaInvisible=void 0!==l.rootElement.data("recaptcha-invisible"),l.config.activationRedirect=l.rootElement.data("activation-redirect")||!1,l.config.getAutoLang=l.rootElement.data("get-auto-lang")||!1,l.config.activateLink=l.rootElement.data("activate-link")||!1,l.config.activateText=l.rootElement.data("activate-text")||!1,l.config.msgUserActived=l.rootElement.data("msg-error-user-actived")||"Su usuario ya está activado. Haga login o recupere su contraseña",l.config.twitterEnabled=l.rootElement.data("twitter-enabled")||!1,l.config.facebookEnabled=l.rootElement.data("facebook-enabled")||!1,"reset"!==l.config.template&&"activation"!==l.config.template||(l.config.ticket=l.getQueryParam("ticket")),"login"===l.config.template&&(e=l.getQueryParam("redir"))&&(l.config.loginRedir=atob(e)),l.config.captcha&&"register"!==l.config.template&&"remember"!==l.config.template&&(l.config.captcha=!1),l.config.reCaptchaKey&&"register"!==l.config.template&&"remember"!==l.config.template&&(l.config.reCaptchaKey=!1,l.config.reCaptchaInvisible=!1,l.config.reCaptchaVisible=!1)},BbvaComponent.authbbva.prototype.submitEvent=function(){l.config.template?s("#wp_auth_form_".concat(l.config.template)).on("submit",function(e){e.preventDefault();var e=s(this),t=!1,e=(l.config.captcha&&(t={captcha:{id:l.config.captchaID,text:l.rootElement.find('input[name="captcha"]').val()}}),l.getFormData(e,t));return l.sendForm(e),!1}):(console.error("Error loading configuration"),l.showMsg("Error loading configuration","danger"))},BbvaComponent.authbbva.prototype.showMsg=function(e,t,o){var a,n="wp_tmp_alert_".concat((new Date).getTime());o?((a=o.parents(".form-group").first()).find(".help-block").remove(),a.addClass("has-error").append('<span class="help-block">'.concat(e,"</span>")),o.on("focus",function(){a.removeClass("has-error").find(".help-block").remove()}),o=o.offset().top,s("html, body").animate({scrollTop:o},100)):(l.rootElement.prepend('<div class="'.concat(n," wp_tmp_alert wp_tmp_alert_top alert alert-").concat(t,' alertform" role="alert"><p>').concat(e,"</p></div>")),l.rootElement.append('<div class="'.concat(n," wp_tmp_alert wp_tmp_alert_bottom alert alert-").concat(t,' alertform" role="alert"><p>').concat(e,"</p></div>")),setTimeout(function(){s(".".concat(n)).remove()},3e3))},BbvaComponent.authbbva.prototype.drawComponent=function(){l.config.template?l.createHTML():(console.error("Error loading configuration"),l.showMsg("Error loading configuration","danger"))},BbvaComponent.authbbva.prototype.createHTML=function(){var e,t='<form id="wp_auth_form_'.concat(l.config.template,'" novalidate="novalidate">');switch(l.config.template){case"login":t=(t=(t=(t=(t=(t=(t=(t=(t+='<div class="form-group">')+'<label for="wp_login_username">'.concat(l.config.usernameText,"</label>"))+'<input autocomplete="off" type="text" class="form-control" id="wp_login_username" name="username" placeholder="'.concat(l.config.usernameText,'">'))+"</div>"+'<div class="form-group">')+'<label for="wp_login_password">'.concat(l.config.passwordText,"</label>"))+'<input autocomplete="off" type="password" class="form-control" id="wp_login_password" name="password_login" placeholder="'.concat(l.config.passwordText,'">'))+"</div>"+'<div class="form-group">')+'<label for="wp_login_remember_me">'.concat(l.config.rememberMeText,"</label>"))+'<input type="checkbox" class="form-control" id="wp_login_remember_me" name="remember_me" placeholder="'.concat(l.config.rememberMeText,'">')+"</div>";break;case"register":t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t+='<div class="form-group">')+'<label for="wp_register_name">'.concat(l.config.nameText,"</label>"))+'<input autocomplete="off" type="text" class="form-control" id="wp_register_name" name="name" placeholder="'.concat(l.config.nameText,'">'))+"</div>"+'<div class="form-group">')+'<label for="wp_register_surname">'.concat(l.config.surnameText,"</label>"))+'<input autocomplete="off" type="text" class="form-control" id="wp_register_surname" name="surname" placeholder="'.concat(l.config.surnameText,'">'))+"</div>"+'<div class="form-group">')+'<label for="wp_register_username">'.concat(l.config.usernameText,"</label>"))+'<input autocomplete="off" type="text" class="form-control" id="wp_register_username" name="username" placeholder="'.concat(l.config.usernameText,'">'))+"</div>"+'<div class="form-group">')+'<label for="wp_register_email">'.concat(l.config.emailText,"</label>"))+'<input autocomplete="off" type="email" class="form-control" id="wp_register_email" name="email" placeholder="'.concat(l.config.emailText,'">'))+"</div>"+'<div class="form-group">')+'<label for="wp_register_password">'.concat(l.config.passwordText,"</label>"))+'<input autocomplete="off" type="password" class="form-control" id="wp_register_password" name="password" placeholder="'.concat(l.config.passwordText,'">'))+"</div>"+'<div class="form-group">')+'<label for="wp_register_password2">'.concat(l.config.password2Text,"</label>"))+'<input autocomplete="off" type="password" class="form-control" id="wp_register_password2" name="password2" placeholder="'.concat(l.config.password2Text,'">')+"</div>",l.config.roles&&(t+='<div class="form-group"><div id="roles"></div></div>',l.apiCall("authbbva/users/roles",{project:this.getProject()},"GET",!1,function(e,t){if(e)return console.error(e);if(t&&t.data&&Array.isArray(t.data)&&t.data.length){var o='<label for="wp_user_role">'.concat(l.config.userRolesText,"</label><br/>");t.data=t.data.map(function(e){return e.replace("ROLE_OW_".concat(l.getProject(),"_"),"")});for(var a=0;a<t.data.length;a++)o+='<div class="form-check form-check-inline" style="float:left;padding:15px;">\n                    <input class="form-check-input" type="checkbox" name="roles" id="roleCheckbox'.concat(a,'" value="').concat(t.data[a],'">\n                    <label class="form-check-label" for="roleCheckbox').concat(a,'" style="margin-left:10px;">\n                      ').concat(t.data[a],"\n                    </label>\n                  </div>");s("#roles").append(o)}}));break;case"remember":t=(t=(t+='<div class="form-group">')+'<label for="wp_remember_email">'.concat(l.config.emailText,"</label>"))+'<input type="email" class="form-control" id="wp_remember_email" name="email" placeholder="'.concat(l.config.emailText,'">')+"</div>";break;case"reset":t=(t=(t=(t=(t=(t=(t=(t=(t+='<div class="form-group">')+'<label for="wp_reset_password">'.concat(l.config.passwordText,"</label>"))+'<input type="password" class="form-control" id="wp_reset_password" name="password" placeholder="'.concat(l.config.passwordText,'">'))+"</div>"+'<div class="form-group">')+'<label for="wp_reset_password2">'.concat(l.config.password2Text,"</label>"))+'<input type="password" class="form-control" id="wp_reset_password2" name="password2" placeholder="'.concat(l.config.password2Text,'">'))+"</div>"+'<div class="form-group">')+'<label for="wp_reset_ticket">'.concat(l.config.ticketText,"</label>"))+'<input type="text" class="form-control" id="wp_reset_ticket" name="ticket" value="'.concat(l.config.ticket||"",'" placeholder="').concat(l.config.ticketText,'">')+"</div>";break;case"request-activation":t=(t=(t+='<div class="form-group">')+'<label for="wp_activation_email">'.concat(l.config.emailText,"</label>"))+'<input type="text" class="form-control" id="wp_activation_email" name="email" placeholder="'.concat(l.config.emailText,'">')+"</div>";break;case"activation":t=(t=(t+='<div class="form-group">')+'<label for="wp_activation_ticket">'.concat(l.config.ticketText,"</label>"))+'<input type="text" class="form-control" id="wp_activation_ticket" name="ticket" value="'.concat(l.config.ticket||"",'" placeholder="').concat(l.config.ticketText,'">')+"</div>";break;default:t+="<h1>Template error</h1>"}l.config.captcha?t+=l.getCaptchaHtml():l.config.reCaptchaKey&&(t+=l.getReCaptchaHtml(l.config)),t=(t+='<div class="form-group">')+'<button type="submit" class="btn btn-default wp_submit_button">'.concat(l.config.sendText,"</button>"),"login"!==l.config.template&&"register"!==l.config.template||((e=l.getQueryParam("redir"))||(1<(e=l.config.loginRedir.split("//")).length&&((e=e[1].split("/")).shift(),e="/"+e.join("/")),e=btoa("".concat(window.location.origin).concat(e))),e="".concat(window.location.origin,"/rrss/?redir=").concat(e,"&client_id=").concat(l.getProject(),"&social="),l.config.twitterEnabled&&!l.config.roles&&(t+='<a class="btn btn-default wp_twitter_button" href="'.concat(e,'TWITTER">Twitter</a>')),l.config.facebookEnabled&&!l.config.roles&&(t+='<a class="btn btn-default wp_facebook_button" href="'.concat(e,'FACEBOOK">Facebook</a>'))),t+="</div>","login"===l.config.template&&(t=(t=(t+='<div class="form-group">')+'<a href="'.concat(l.config.rememberLink,'" class="wp_rememberLink">').concat(l.config.rememberText,"</a>"))+'<a href="'.concat(l.config.registerLink,'" class="wp_registerLink">').concat(l.config.registerText,"</a>"),l.config.activateLink&&(t+='<a href="'.concat(l.config.activateLink,'" class="wp_activateLink">').concat(l.config.activateText,"</a>")),t+="</div>"),"activation"===l.config.template&&l.config.activateLink&&(t=(t+='<div class="form-group">')+'<a href="'.concat(l.config.activateLink,'" class="wp_activateLink">').concat(l.config.activateText,"</a>")+"</div>"),"register"===l.config.template&&(t+='<div class="form-group wp_loginlink"><a href="'.concat(l.config.loginLink,'">').concat(l.config.loginText,"</a></div>")),l.rootElement.append(t+="</form>"),l.config.reCaptchaKey&&l.renderRecaptcha()},BbvaComponent.authbbva.prototype.getCaptchaHtml=function(){var e='<div class="wp_captcha_wrapper form-group">';return e+'<div class="form-group">'+'<img class="wp_captcha_image" src=""/>'+'<img class="wp_captcha_get_new" src="'.concat(l.libs,'assets/img/icon-refresh.png"/>')+"</div>"+'<div class="form-group">'+"<label>".concat(l.config.captchaText,"</label>")+'<input class="wp_captcha_input form-control" type="text" name="captcha" placeholder="'.concat(l.config.captchaText,'">')+"</div>"+"</div>"},BbvaComponent.authbbva.prototype.loadUser=function(o){if(window.wpBbvaUserLogged)return"function"==typeof o&&o(window.wpBbvaUserLogged);l.apiCall("private/authbbva/",{project:l.getProject()},!1,!1,function(e,t){"function"==typeof o&&(e?o(e):(window.wpBbvaUserLogged=new BbvaComponent.authbbva.User(t.data),o(null,window.wpBbvaUserLogged)))})},BbvaComponent.authbbva.prototype.logout=function(t){s.ajax({url:"".concat(l.armadillo,"users/access"),type:"DELETE",success:function(){"function"==typeof t&&t()},error:function(e){"function"==typeof t&&t(e)}})},BbvaComponent.authbbva.prototype.getTicket=function(e,t,o){s.ajax({url:"".concat(l.armadillo,"ticket"),type:"POST",data:{service:e,user_id:t},success:function(e){e=JSON.parse(e).data,o(null,e.ticket)},error:function(e){o(e)}})},BbvaComponent.authbbva.prototype.getTicketEmail=function(o){l.apiCall("private/authbbva/ticket-email",{project:l.getProject()},!1,!1,function(e,t){"function"==typeof o&&(e?o(e):o(null,t.data.ticket))})},BbvaComponent.authbbva.prototype.changeEmail=function(o,a){var e;if(!validateEmail(o))return e=new Error("Invalid email"),"function"==typeof a?a(e):e;l.getTicketEmail(function(e,t){if(e)return"function"==typeof a?a(e):e;s.ajax({url:"".concat(l.armadillo,"users/emails?ticket=").concat(t),type:"PUT",data:JSON.stringify({new_email:o}),contentType:"application/json",processData:!1,success:function(){return"function"==typeof a?a():null},error:function(e){return"function"==typeof a?a(e):e}})})},BbvaComponent.authbbva.prototype.changeEmailProxy=function(e,o){var t;return validateEmail(e)?(t=window.wpBbvaUserLogged.get("user_id"))?void l.apiCall("private/authbbva/".concat(t,"/email"),!1,"PATCH",{email:e},function(e,t){"function"==typeof o&&(e?o(e):o(null,t))}):(t=new Error("User not logged"),"function"==typeof o?o(t):t):(e=new Error("Invalid email"),"function"==typeof o?o(e):e)},BbvaComponent.authbbva.prototype.changeAvatar=function(e,o){l.apiCall("private/authbbva/user-avatar",{project:l.getProject()},"POST",e,function(e,t){"function"==typeof o&&(e?o(e):o(null,t.data.path))})},BbvaComponent.authbbva.prototype.changePassword=function(e,t,o){s.ajax({url:"".concat(l.armadillo,"users/passwords"),type:"PUT",data:JSON.stringify({old_password:btoa(e),new_password:btoa(t)}),contentType:"application/json",processData:!1,headers:{"Content-Type":"application/json"},success:function(){return"function"==typeof o?o():null},error:function(e){return"function"==typeof o?o(e):e}})},BbvaComponent.authbbva.User=function(e){var a=e,n=(a.custom=e.custom||{},a.optional_data=e.optional_data||{},JSON.parse(JSON.stringify(a)));function r(e){var t=new Error("User was previously deleted");if(!0!==a.deleted)return 1;if("function"!=typeof e)throw t;e(t)}this.get=function(e){return r(),a[e]},this.set=function(e,t){if(r(),"password"===e||"email"===e)throw new Error("Email and passwords have custom methods");a[e]=t},this.logout=function(e){return l.logout(e)},this.changePassword=function(e,t,o){r(o)&&l.changePassword(e,t,o)},this.changeEmail=function(t,o){r(o)&&l.changeEmail(t,function(e){return e||(a.email=t,n.email=t),"function"==typeof o?o(e):e})},this.changeAvatar=function(e,o){var a=this;if(r(o))try{var t,n=s("#".concat(e))[0].files[0];if(819200<n.size)return(t=new Error("File size limit 800KB")).code=5001,o(t);if(-1===["image/jpeg","image/jpg","image/png","image/gif"].indexOf(n.type))return(t=new Error("jpeg, jpg and png allowed")).code=5002,o(t);l.changeAvatar(n,function(e,t){if(e||!t)return"function"==typeof o?o(e):e;e=a.get("optional_data");e.ow_avatar=t,a.set("optional_data",e),a.update(o)})}catch(t){if("function"!=typeof o)throw t;o(err)}},this.getLang=function(){return r(),this.get("optional_data").ow_lang},this.setLang=function(e){r();var t=this.get("optional_data");t.ow_lang=e,this.set("optional_data",t)},this.update=function(t){r(t)?l.apiCall("private/authbbva/",{project:l.getProject()},"PUT",a,function(e){if(e||(n=JSON.parse(JSON.stringify(a))),"function"==typeof t)return t(e||null)}):"function"==typeof t&&t("Nothing to update")},this.delete=function(t){r(t)&&l.apiCall("private/authbbva/",{project:l.getProject()},"DELETE",!1,function(e){if(e||(n={},a={deleted:!0}),"function"==typeof t)return t(e||null)})}},BbvaComponent.authbbva.prototype.autoLogin=function(){var e="".concat(l.armadillo,"users/access");s.ajax({url:e,type:"POST",success:function(e,t,o){l.setCookie(l.config.cookieRemember,!0),l.config.loginRedir&&window.location.replace(l.config.loginRedir)},error:function(){l.setCookie(l.config.cookieRemember,!1,{expires:0}),l.init(!0)}})},BbvaComponent.authbbva.prototype.init=function(e){if((l=this).loadConfig(),!e&&"login"===l.config.template&&l.getCookie(l.config.cookieRemember))return l.autoLogin();l.drawComponent(),l.submitEvent(),l.loadEvents()},BbvaComponent.authbbva.prototype.constructor=BbvaComponent.authbbva}(jQuery);